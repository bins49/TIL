### Next.js란?

- Sever-side rendering 

  - html을 서버에서 만드는 짓
  - 유저한테 자바스크립트 코드를 많이 보내지 않아서 가볍고
  - 구글 검색 노출도 더 잘 돼
  - 프론트엔드 전문기술 별로 필요없다.
  - 누구나 큰 그림만 이해를 잘 알면 개발을 잘하는 시대가 온다. 
  - 풀스택이 기본인 세상(서버 개발 알자)

- Client-side rendering

  - 리액트, 뷰 같은 라이브러리를 써서 웹 페이지를 서버가 아니라 유저 브라우저에서 실시간으로 만들어주는 것
  - 유저 브라우저에서 실시간으로 html을 만들어준다. 
  - 페이지 전환이 부드럽고, 앱 같이 예쁜 사이트 만들 수 있다.
  - 단점
    - 구글 검색노출이 좀 어렵고
    - 페이지 로딩속도가 느리다
    - 수익성에 악영향

  

- Next.js는 풀스택 프레임워크 
  - 프론트엔드 + 백엔드 
  - 리액트 신기술 도입하고 있어
  - 파일과 폴더만 만들면 자동으로 html 페이지 생성
  - 서버 기능 만들거나 DB 연결, 회원 인증 등 간편해짐
  - 클라이언트 사이드 렌더링 가능
  - 서버 데이터 캐싱 쉽고 
  - 폰트, 이미지 최적화 가능
  - 잘나가는 프레임워크
  - 단점
    - 폴더 기반 라우팅을 해주니까 예약 파일이 많아져서 프로젝트가 커지면 복잡해진다. 
    - 리액트 미완성 기능을 도입
    - 클라이언트 컴포넌트, 서버 컴포넌트랑 분리해서 만들어야해서 컴포넌트.js 파일 많아진다.
    - 웹소켓, webRTC의 경우에는 node.js 서버에서 만들어야한다. 
    - 풍부한 서버기능보다는 그냥 HTML 렌더링만 잘할 뿐이다. 





### 설치

- 프로젝트 생성
  - `npx create-next-app@latest`
- 페이지 미리보기
  - `npm run dev`



#### 폴더/파일 구성

- app => page.js가 메인페이지
- app => layout.js(page.js를 감싸는 파일)
  - 페이지 밖에다 적어야하면 모두 layout.js에 적는다. 
    - 예를 들어, head태그에 적는거, 상단메뉴... 등
- global.css (모든 페이지에 적용할 스타일)
- xxx.module.css (특정 페이지에만 적용가능)
- api 폴더는 서버기능을 만든다.
- Node_modules는 설치한 라이브러리 보관해주는 곳이다. 
- public 폴더에는 보통 이미지 등 소스코드 외의 파일들 보관용
- package.json는 설치한 라이브러리 자동으로 기록해주고 터미널에 쓸 수 있는 명령어도 파일에 저장되어 있다. 





#### 페이지 레이아웃 만들기

- 웹사이트 레이아웃 어떻게 만들죠?
  - 리액트버전 HTML, CSS 작성한다.
- return() 안에 HTML 넣을 때
  - 평행해서 HTML 요소들을 2개 이상 만들 수 없다
    - div박스 2개 이상 못 만든다. 
  - 1개의 <태그>로 시작해서 끝나야한다. 

- Class 넣고 싶으면 className을 넣어야 한다. 

  - 그리고 global.css에 적용하면 된다. 

- HTML 안에 변수 넣으려면?

  - 생 자바스크립트에서는 `document.getElementsByClassName('.title-sub')[0].innerHTML = name`
  - 그러나 리액트에서는 변수 작성하고 {}중괄호만 써서 그 안에 변수 넣어주면 값을 사용할 수 있다. 
    - 전문용어로 JSX의 데이터바인딩 문법
  - 링크, className, src 등 웬만한 거에는 중괄호 사용해서 간편하게 사용 가능

  ```react
  export default function Home() {
    let name = "park";
    let age = 20;
    let link = "http://google.com"
    return (
      <div>
        <h4 className="title">애플후레시</h4>
        <p className="title-sub">by dev {name} {age}</p>
        <a href={link}>링크</a>
      </div>
    )
  }
  ```

  

- style 속성 넣을면

  - style = {{ 어쩌구 : "저쩌구"}} 형식으로 넣어야 한다. 
  - Object 자료형이기 떄문에 style 속성 넣으려면 `-`기호 사용 불가능이고 뒤에오는 문자는 대문자로 바꿔야 한다.

  ```react
  export default function Home() {
    let name = "park";
    let age = 20;
    let link = "http://google.com"
    return (
      <div>
        <h4 className="title" style={{color : "red", fontSize : "20px"}}>애플후레시</h4>
        <p className="title-sub">by dev {name} {age}</p>
        <a href={link}>링크</a>
      </div>
    )
  }
  ```





#### 여러 페이지 만들기 (라우팅)

- /list로 접속하면 상품목록페이지 보여주자

- url로 페이지를 나누는 행위를 라우터라고 한다. 

- Next.js는 자동 라우팅 기능이 존재 폴더/파일 하나만 만들자

  - list라는 폴더 안에 page.js라는 파일을 만들었다. (list로 접속시 page.js 내용 보여준다.)
  - 그 안에 레이아웃 넣으면 된다. 

- page.js만드는 법

  - 컴포넌트 이름을 폴더명이랑 비슷하게 한다. (List로 )
  - 컴포넌트 만들어서 export default를 해야 자동으로 html 페이지가 된다. 

  ```react
  export default function List() {
    return (
      <div>
        <h4 className="title">상품목록</h4>
      </div>
    )
  }
  ```

- 상단바 만들기 

  - Link 태그를 쓰자

  ```react
  import Link from "next/link"
  
  export default function Home() {
    let name = "park";
    let age = 20;
    let link = "http://google.com"
    return (
      <div>
        <div className="navbar">
          <Link href="/">home</Link>
          <Link href="/list">list페이지</Link>
        </div>
        <h4 className="title" style={{color : "red", fontSize : "20px"}}>애플후레시</h4>
        <p className="title-sub">by dev {name} {age}</p>
        <a href={link}>링크</a>
      </div>
    )
  }
  ```

  - 근데 공통UI는 어떻게 할까? 

    - 모든 페이지에 상단바를 만들기
      - layout.js에 만들기
        - children이 page.js를 가리킨다. 

    ```react
    import './globals.css'
    import { Inter } from 'next/font/google'
    import Link from "next/link"
    
    const inter = Inter({ subsets: ['latin'] })
    
    export const metadata = {
      title: 'Create Next App',
      description: 'Generated by create next app',
    }
    
    export default function RootLayout({ children }) {
      return (
        <html lang="en">
          <body className={inter.className}>
            <div className="navbar">
              <Link href="/">home</Link>
              <Link href="/list">list페이지</Link>
            </div>
            {children}
          </body>
        </html>
      )
    }
    ```

    - 근데 page.js 옆에 layout.js가 없는데??

      - 옆에 layout.js 있으면 그걸로 page.js 싸맨다. 
      - 상위폴더에 layout.js가 있으면 그걸로 1번 싸맨다. 
      - 상위폴더에 또 layout.js가 있으면 그걸로 2번 싸맨다. 
      - 결론: 페이지변경과 상관없이 계속 보여줄 UI는 layout.js 쓰면 편하다.

    - 예제 문제

      - `/cart 페이지, /cart/payment 페이지 둘 다 <p>현대카드 무이자이벤트중</p> 이런 UI가 보여야합니다.`

        - 그러려면 cart 폴더에 layout.js 파일을 만들어서 이렇게 적어놓으면 된다. 

        ```react
        export default function Layout({ children }) {
          return (
            <div>
              <p>현대카드 무이자이벤트중</p>
              {children}
            </div>
          )
        }
        ```

        

#### html을 반복문으로 줄이고 싶으면 map

```react
export default function List() {
  // db코드 바뀌니까 하드코딩 하지 마셈(db데이터 적용 불가능)
  let 상품 = ["Tomatoes", "Pasta", "Coconut"]
  let 어레이 = [2, 3, 4]
  어레이.map((a, i) => {
    // 함수안의 코드를 어레이 개수만큼 반복
    // map기능() return에 적은걸 array로 담아준다.
    console.log("안녕")
  })
  // 반복적인 코드만 map 활용해서 return 문을 그 안에 작성한다.
  return (
    <div>
      <h2>Products</h2>
      { 상품.map((e, i) => {
        return (
          <div className="food">
            <h4>{e} $40</h4>
          </div>
        )
      })}
    </div>
  )
}
```





#### Next.js에서 이미지 넣는 법 2개

- 이미지 넣는 법
  - `<img src=""/>`

```react
return (
    <div>
      <h2>Products</h2>
      { 상품.map((e, i) => {
        return (
          <div className="food" key={i}>
            <img src="/food0.png" className="food-img"/>
            <h4>{e} $40</h4>
          </div>
        )
      })}
    </div>
  )
```

- 최적화된 이미지로 넣을 수 있다

  - import next/image를 하면 아래와 같은 장점으로 이미지를 사용할 수 있다.
    - lazy loading
    - 사이즈최적화
    - layout shift 방지
      - 이미지 로딩이 늦게 돼서 사이트 레이아웃이 밀려나는 현상
    - 대신 image도 import해서 사용해야 한다.
  - 단점
    - 각각 다른 이미지를 보여주고 싶을 때 src 안에 require("이미지경로") 이런거 써야한다.
    - 외부이미지를 집어 넣을 때 반드시 width, height 속성을 줘야한다. 
      - `<Image src="https://s3.amazonaws.com/my-bucket/profile.png" width="500" height="500"/>`
    - next.config.js 셋팅도 필요하다
    - 그래서 외부 사이트 이미지들은 그냥 `<img>` 태그 쓰는게 편할 수도 있다.

  ```react
  import Image from "next/image"
  import 작명 from "public/food0.png"
  
  import Image from "next/image"
  import 작명 from "public/food0.png"
  
  export default function List() {
    let 상품 = ["Tomatoes", "Pasta", "Coconut"]
    return (
      <div>
        <h2>Products</h2>
        { 상품.map((e, i) => {
          return (
            <div className="food" key={i}>
              <Image src={작명} className="food-img"/>
              <h4>{e} $40</h4>
            </div>
          )
        })}
      </div>
    )
  }
  ```





#### client/server component, import 문법

- 길고 복잡한 html을 한 단어로 축약하려면 Component

- 재사용이 잦은 html 덩어리들을 주로 Component로 만드는게 좋다. 

- component 만드는법

  - 1. Function 작명() {}
  - 2. return (축약할 긴 HTML)
  - 3. `<작명 />`사용

- Component 단점

  - Component끼리 데이터 공유 귀찮다.

- function 문법 쓰는 이유

  - 더러운 코드 한 단어로 축약
  - 같은 코드 재사용

- Component 문법 쓰는 이유

  - 더러운 코드 한 단어로 축약
  - 같은 코드 재사용

- Next.js 컴포넌트는 종류가 2개이다

  - 1.server component

    - 아무데나 대충 만든건 server component이다.

    - html에 자바스크립트 기능넣기 불가능(ex)onClick)

    - useState, useEffect 등 사용 불가능

    - 로딩속도 빠름(페이지 로드에 필요한 자바스크립트 양이 적어서 빠름)

    - 검색노출 잘됨

    - 큰 페이지는 server component

    - 예시

      ```raect
      export default function Cart() {
        return (
          <div>
            <h4 className="title">Cart</h4>
            <div className="cart-item">
              <p>상품명</p>
              <p>$40</p>
              <p>1개</p>
            </div>
            <CartItem />
            <CartItem />
          </div>
        )
      }
      
      function CartItem() {
        return (
          <div className="cart-item">
            <p>상품명</p>
            <p>$40</p>
            <p>1개</p>
          </div>
        )
      }

  - 2.client component

    - 파일 맨 위에 "use client"넣고 만든건 client component
    - html에 자바스크립트 기능넣기 가능(onClick)
    - useState, useEffect 등 사용 가능
    - 로딩속도 느림 1(자바스크립트 많이 필요)
    - 로딩속도 느림 2(hydration 필요)
      - hydration이란 html 유저에게 보낸 후에 자바스크립트로 html 다시 읽고 분석하는 일 
    - 꼭 필요한 때만 쓰자
    - JS 기능 필요한 곳만 client component

    ```react
    'use client'
    
    export default function Cart() {
      return (
        <div>
          <h4 className="title">Cart</h4>
          <div className="cart-item">
            <p>상품명</p>
            <p>$40</p>
            <p>1개</p>
          </div>
          <CartItem />
          <CartItem />
        </div>
      )
    }
    
    function CartItem() {
      return (
        <div className="cart-item">
          <p>상품명</p>
          <p>$40</p>
          <p>1개</p>
        </div>
      )
    }
    ```

  - 데이터를 import 하려면 항상 export 먼저 해야한다. 

  - export default는 단점이 존재한다. 한개 밖에 못 보낸다.

    - 해결법 
      - `export {변수1, 변수2}`
      - `import {변수1, 변수2}`





#### Components에 데이터 전해주려면 props

- 컴포넌트가 부모 자식관게인 경우 props 문법을 이용하면 된다. 
- 부모에 있던 변수, 함수들을 자식이 사용하고 싶으면 props 문법으로 전송해줄 수 있다. 

- 1. 자식컴포넌트 사용하는 곳에 가서 **<자식컴포넌트 작명={전해줄데이터} />** 

  2. 자식컴포넌트 만드는 곳에 가서 props라는 파라미터 등록 후 **props.작명** 사용하면 됩니다.

   props 전송문법은 중요하니 외워두도록 합시다. 

- 참고로 자식 -> 부모 방향 전송은 불가능하다. 

- 옆집 컴포넌트도 전송 불가능하다. 

- ! 중요 데이터가 많은 컴포넌트에서 필요하면 그들 중 최고 부모 컴포넌트에 보관해야 좋다. 

- Next js 예외사항이 있는데 

  - 부모랑 자식이 같은 데이터를 가지고 있어도 문제가 없을 수도 있다.
  - fetch() 로 DB데이터를 가져오는데 똑같은 데이터를 여러번 요청하면 하나로 압축해서 한 번만 보내준다.(deduplication 기능)

- 매번 약간 다른 내용으로 컴포넌트 만들고 싶을 때 props 문법 사용한다.
- 비슷한 컴포넌트이면 여러개 만들지 말자. props 활용하자

```react
export default function Cart() {
  return (
    <div>
      <h4>Cart</h4>
      <Banner content="롯데카드"/>
      <Banner content="현대카드"/>
    </div>
  )
}

function Banner(props) {
  return <h5>{props.content}카드 결제 행사중</h5>
}
```



#### 좋아요 버튼 만들기(useState, onClick)

- 이벤트 핸들러
  - 어떤 사건에 대한 동작을 다룬다
  - 마우스가 버튼에 닿았을때 "어떻게 해줘" 이런 방식임
  - click, mouseover, mouseout 등등 여러가지 이벤트 핸들러가 존재

- State 장점
  - state 변경되면 state html 부분도 자동 재렌더링 
- State 좋으니까 모든 내용들을 stat로 만들어서 넣으면 좋겠다?
  - 굳이 변동될 일이 없는 데이터들은 state로 만들 필요는 없다. 

```react
'use client';
import {useState} from 'react'

export default function List() {
  let [수량, 수량변경] = useState(0)
  return (
    <div>
      <h4 className="title">상품목록</h4>
      { 상품.map(()=>{
        <div className="food" key={i}>
          <img src={`/food${i}.png`} className="food-img"/>
          <h4>{a} $40</h4>
          <span> {수량} </span>
          <button onClick={()=>{ 수량변경(수량+1) }}>+</button>
        </div>
      }) }
    </div> 
  )
} 
```



#### 좋아요 버튼 만들기 2 (array, objectm state 변경하려면)

- 상품마다 개별적으로 수량을 저장하려면 
  - 모든 상품수량이 똑같네요?
    - array 자료를 활용해서 상품 수량을 저장하자.

```react
let [수량, 수량변경] = useState([0, 0, 0])
```

- 버튼 누르면 첫 상품수량을 +1 해보자

  - 핵심: array는 항상 복사해서 수정해야함
  - state 변경함수 사용시 
    - 새 state === 기존 state일 경우 변경하지 않는다. 

  ```react
  <button onClick={() => {
     let copy = [...수량];
     copy[i] ++;
     수량변경(copy)
  }}>+</button>
  ```

  - 왜 복사를 해야할까?

    - (array/object 자료 만들면 일어나는 일)

      - 예) let arr = [1, 2, 3] 인데
      - 여기서 arr는 RAM [1, 2, 3]을 가리키고 있다.
      - let arr2 = arr 이거는 1,2,3 을 복사하는 게 아니라 화살표를 복사하는 것 

    - 그래서 독립적인 array 만들어서 복사해준다.

      `[...배열]` 은 독립적인 array를 만든다.

    - 숫자, 문자, boolean은 굳이 복사할 필요 없다. 

  

